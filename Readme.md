# Описание
Отправка замеров времени(мс) выполнения кода в Zabbix.

# Состав
* компонента Addin.ZabbixStatistics используемая в 1с
* SQL база с таблицей, куда отправляются замеры
* служба, которая периодически отправляет статистику в Zabbix

# Использование
## Создать таблицу
Желательно создать отдельную базу с таблицей ```Statistics``` а также отдельного пользователя.
Для создания таблицы ```Statistics``` воспользуйтесь скриптом
```
CREATE TABLE [dbo].[Statistics](
	[Time] [datetime] NOT NULL,
	[Basename] [nchar](50) NOT NULL,
	[Param] [nchar](50) NOT NULL,
	[Value] [int] NOT NULL
) ON [PRIMARY]
```
Укажите в ```config.ini``` параметры подключения к SQL и название БД

## Настройки Zabbix
Желательно создать отдельный узел(параметр ```ZabbixNodeName```  в настройках), в нем создать элемент данных с типом Zabbix траппер.
Формат ключа ```1C.Statistics[НазваниеБазы,ПараметрМетодаНачать]```

## Установить службу
Установите службу скриптом ```!InstallService.bat```, укажите параметры в настройках ```ZabbixServer```(zabbix сервер), ```ZabbixPort```(zabbix порт), ```ZabbixNodeName```(название узла в zabbix). Запустите службу.
## Использование компоненты
Сначала нужно зарегистрировать компоненту скриптом ```!RegisterDll.bat``` 
В конфигурации желательно **один** раз создать объект заббикс, и его использовать, где требуются замеры
```
// объявить в глобальном модуле переменную
Перем Заббикс;

// Указать следующий код в ПриНачалаеРаботыСистемы
Заббикс = СоздатьОбъект("Addin.ZabbixStatistics");
Заббикс.НазваниеБазы = "НазваниеБазы";
Заббикс.Инициализация();
```
Использование в требуемом месте:
```
Заббикс.Начать("ПараметрМетодаНачать");
//
//  Ваш код для замеров
//
Заббикс.Закончить();
```
**Параметр метода начать должен соответствовать требованиям zabbix, т.е. на русском параметр писать нельзя!!!**

# Описание дополнительных настроек
```ThreadSleep``` - задержка перед отправкой замеров компонентой в sql.
```ZabbixNodeName``` - задержка на получение средних показателей и отправка в zabbix
